webpackJsonp([0xb27d78f0b95b],{810:function(e,t){e.exports={data:{post:{id:"C:/Users/opw/Desktop/workspace/blog/content/posts/2019-01-15--sentry-docker/index.md absPath of file >>> MarkdownRemark",html:'<p>\n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 45.42284219703575%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACBElEQVQoz1WS2W4TQRBF/Q4kTrzN5vHs+55Z7LFjjx0l2LIdMIklhIh45AGJP+APEL98qWkEEg9X3eruqr51qjqG4qFI50iDEmNOw6ArYnQ9xvBK+qcxZ0CVXKiiA5n2Cm9iPNIgDTWovA5FMGEqAclHpw3+q94Fj+6rIa7fcP9p0JXojoM00mHIARwKjMwMhVeicBKkRkAfaeB6Mjr6xEVJDkP3hrmsbhYI7AyRl9OaYpovEfs5IreCLvvIwlscZyvMgilqen+ar7AMYhiSg/6liI5nJfh4/oyHuwPe7Z9x2L7HI627+yP7oE36dHzB968/UKVrlEmD0/YTpl6CuRviUBEu+qxF0uLqKKJFbgp4ZoLEL4iDR25z+FaKCbHqX4ho6gNezt8Q2RVkOku8Gg+rE3aLLXZ5jpoq8CiudymgIxJYhWC3iVv4iuBgIti0N4mXz86KaEVq6M5G5FSsGXxvQm43uF99wF25xsyL/ySUOQuOlsMmOVpGDkPWscgmnvEaoVUh8xZwtRSunuFt84Rmtif3FmtYayYLl9DGLjHkiaG+wfP+J877X7gtvlCpMep8g5Icpd6cJbOUGMJAhdBXWNl5sGTngVmA709w9XpIyQQ2YjQ2MtlXIQ4NOGpKrhrk1MnAyBE7M5o9l0rhGfA2qEUS21NqRE2a07iY7K5N1q6/AUzKDIJlnJgiAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="sentry-banner"\n        title=""\n        src="/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-6cf1b.png"\n        srcset="/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-dbbfd.png 200w,\n/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-1cc64.png 400w,\n/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-6cf1b.png 800w,\n/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-f44ef.png 1147w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  </p>\n<p><a href="https://github.com/getsentry/sentry">Sentry</a> is a an open-source error tracking platform that helps developer to mointor and fix crashes in real time. It supports most popular languages, including but not limited to Java, JavaScript, Node.js, Android, iOS and Python.</p>\n<p>For more details, please visit <a href="../sentry-intro/">Sentry Introduction</a> that I wrote in previous post.</p>\n<p>In this tutorial, we will go through how to set up Sentry via Docker and how to rebuild docker image after installing additional plugin.</p>\n<h2>Introduction</h2>\n<p>Sentry Server is written in Python. It uses Django as the web framework. Sentry also relies on the following services:</p>\n<ul>\n<li>Postgres</li>\n<li>Redis</li>\n<li>Memcached</li>\n</ul>\n<p>Sentry can be installed via Docker or via Python. We will only cover how to install via Docker in this tutorial.</p>\n<h2>Prerequisite</h2>\n<ul>\n<li>Docker 1.10.0+ <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">(Installation Guide)</a></li>\n<li>Docker Compose 1.6.0+ <a href="https://docs.docker.com/compose/install/">(Installation Guide)</a></li>\n</ul>\n<h2>Getting Started</h2>\n<ol>\n<li>\n<p>Visit <a href="https://github.com/getsentry/onpremise">Sentry On-Premise Github</a>, and clone the repo to a directory</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">git clone --depth=1 https://github.com/getsentry/onpremise.git</code></pre>\n      </div>\n</li>\n<li>\n<p>Open <code class="language-text">docker-compose.yml</code>, we are going to customize the services we need.</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">version: &#39;3.4&#39;\n\nx-defaults: &amp;defaults\n  restart: unless-stopped\n  build: .\n  depends_on:\n    - redis\n    - postgres\n    - memcached\n    #- smtp\n\n  environment:\n    # Run `docker-compose run web config generate-secret-key`\n    # to get the SENTRY_SECRET_KEY value.\n    SENTRY_SECRET_KEY: &#39;&#39;\n    SENTRY_MEMCACHED_HOST: memcached\n    SENTRY_REDIS_HOST: redis\n    SENTRY_POSTGRES_HOST: postgres\n    SENTRY_EMAIL_HOST: smtp\n  volumes:\n    - sentry-data:/var/lib/sentry/files\n\nservices:\n  #smtp:\n    #restart: unless-stopped\n    #image: tianon/exim4\n\n  memcached:\n    restart: unless-stopped\n    image: memcached:1.4\n\n  redis:\n    restart: unless-stopped\n    image: redis:3.2-alpine\n\n  postgres:\n    restart: unless-stopped\n    image: postgres:9.5\n    volumes:\n      - sentry-postgres:/var/lib/postgresql/data\n\n  web:\n    &lt;&lt;: *defaults\n    ports:\n      - &#39;9000:9000&#39;\n\n  cron:\n    &lt;&lt;: *defaults\n    command: run cron\n\n  worker:\n    &lt;&lt;: *defaults\n    command: run worker\n\nvolumes:\n    sentry-data:\n    sentry-postgres:</code></pre>\n      </div>\n<p>Since we do not want to host a SMTP server by ourselves (will shows you how to set up external SMTP later), so we can comment out all the SMTP related lines.</p>\n</li>\n<li>\n<p>Build and tag the Docker services. It will pull the required docker images specified in <code class="language-text">docker-compose.yml</code> and <code class="language-text">Dockerfile</code>, i.e. <code class="language-text">redis:3.2-alpine</code>, <code class="language-text">postgres:9.5</code>, <code class="language-text">memcached:1.4</code> and <code class="language-text">sentry:9.0-onbuild</code>.</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">docker-compose build</code></pre>\n      </div>\n</li>\n<li>\n<p>After finish building the docker images, we have to generate a secrete key for Sentry</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">docker-compose run --rm web config generate-secret-key</code></pre>\n      </div>\n<p>Add copy the key to <code class="language-text">docker-compose.yml</code> in <code class="language-text">SENTRY_SECRET_KEY</code>.</p>\n</li>\n<li>\n<p>After we have configured the key, we have to run data migration on the postgres database.</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">docker-compose run --rm web upgrade</code></pre>\n      </div>\n<p>In the meantime, there will be interactive prompts to create an admin user account.</p>\n</li>\n<li>\n<p>Starts all the services in detached mode.</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">docker-compose up -d</code></pre>\n      </div>\n<p>By running <code class="language-text">docker ps</code>, you should see 6 running containers as follows:</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\nd746f33fc02c        sentry_worker       &quot;/entrypoint.sh run …&quot;   8 days ago          Up 2 days           9000/tcp                 sentry_worker_1\n9f392974eb82        sentry_cron         &quot;/entrypoint.sh run …&quot;   8 days ago          Up 2 days           9000/tcp                 sentry_cron_1\n288c296596b4        sentry_web          &quot;/entrypoint.sh run …&quot;   8 days ago          Up 2 days           0.0.0.0:9000-&gt;9000/tcp   sentry_web_1\n0e2b7144edce        postgres:9.5        &quot;docker-entrypoint.s…&quot;   8 days ago          Up 2 days           5432/tcp                 sentry_postgres_1\n2f1f93436a77        redis:3.2-alpine    &quot;docker-entrypoint.s…&quot;   8 days ago          Up 2 days           6379/tcp                 sentry_redis_1\ned98daa7e684        memcached:1.4       &quot;docker-entrypoint.s…&quot;   8 days ago          Up 2 days           11211/tcp                sentry_memcached_1</code></pre>\n      </div>\n</li>\n<li>\n<p>Sentry can now be accessed via <code class="language-text">localhost:9000</code></p>\n</li>\n</ol>\n<h2>Set up mail server</h2>\n<ol>\n<li>\n<p>Edit <code class="language-text">config.yml</code>, add the corresponding mail server settings:</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">###############\n# Mail Server #\n###############\nmail.backend: &#39;smtp&#39;  # Use dummy if you want to disable email entirely\nmail.host: &#39;smtp.gmail.com&#39;\nmail.port: 587\nmail.username: &#39;YOUR_EMAIL@gmail.com&#39;\nmail.password: &#39;EMAIL_PASSWORD&#39;\nmail.use-tls: true\nmail.list-namespace: example.com\n# The email address to send on behalf of\nmail.from: &#39;YOUR_EMAIL@gmail.com&#39;</code></pre>\n      </div>\n</li>\n<li>\n<p>You have to stop and remove previous built containers and images</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">docker-compose down</code></pre>\n      </div>\n</li>\n<li>\n<p>Then rebuild, run migrations and restart services</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">docker-compose build # Build the services again after updating\ndocker-compose run --rm web upgrade # Run new migrations\ndocker-compose up -d # Recreate the services</code></pre>\n      </div>\n</li>\n</ol>\n<h2>Google SSO</h2>\n<p><a href="https://github.com/getsentry/sentry-auth-google">GitHub - getsentry/sentry-auth-google: Google Apps SSO provider for Sentry</a></p>\n<ol>\n<li>\n<p>Edit <code class="language-text">requirements.txt</code>, this is the place for specifying dependencies for Python application. Add a new line:</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text"># Add plugins here\nhttps://github.com/getsentry/sentry-auth-google/archive/52020f577f587595fea55f5d05520f1473deaad1.zip</code></pre>\n      </div>\n</li>\n<li>\n<p>Open <code class="language-text">sentry.conf.py</code>, and add Google SSO into the config file:</p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">SENTRY_FEATURES[&#39;organizations:sso&#39;] = True\n\nif &#39;GOOGLE_CLIENT_ID&#39; in os.environ:\n    GOOGLE_CLIENT_ID = env(&#39;GOOGLE_CLIENT_ID&#39;)\n    GOOGLE_CLIENT_SECRET = env(&#39;GOOGLE_CLIENT_SECRET&#39;)</code></pre>\n      </div>\n</li>\n<li>\n<p>Open <code class="language-text">docker-compose.yml</code>, add add the <code class="language-text">GOOGLE_CLIENT_ID</code> and <code class="language-text">GOOGLE_CLIENT_SECRET</code></p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">GOOGLE_CLIENT_ID: &#39;ID_HERE.apps.googleusercontent.com&#39;\nGOOGLE_CLIENT_SECRET: &#39;SECRET_HERE&#39;</code></pre>\n      </div>\n</li>\n</ol>',htmlAst:{type:"root",children:[{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"\n  "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-wrapper"],style:"position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"},children:[{type:"text",value:"\n    "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-background-image"],style:"padding-bottom: 45.42284219703575%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACBElEQVQoz1WS2W4TQRBF/Q4kTrzN5vHs+55Z7LFjjx0l2LIdMIklhIh45AGJP+APEL98qWkEEg9X3eruqr51qjqG4qFI50iDEmNOw6ArYnQ9xvBK+qcxZ0CVXKiiA5n2Cm9iPNIgDTWovA5FMGEqAclHpw3+q94Fj+6rIa7fcP9p0JXojoM00mHIARwKjMwMhVeicBKkRkAfaeB6Mjr6xEVJDkP3hrmsbhYI7AyRl9OaYpovEfs5IreCLvvIwlscZyvMgilqen+ar7AMYhiSg/6liI5nJfh4/oyHuwPe7Z9x2L7HI627+yP7oE36dHzB968/UKVrlEmD0/YTpl6CuRviUBEu+qxF0uLqKKJFbgp4ZoLEL4iDR25z+FaKCbHqX4ho6gNezt8Q2RVkOku8Gg+rE3aLLXZ5jpoq8CiudymgIxJYhWC3iVv4iuBgIti0N4mXz86KaEVq6M5G5FSsGXxvQm43uF99wF25xsyL/ySUOQuOlsMmOVpGDkPWscgmnvEaoVUh8xZwtRSunuFt84Rmtif3FmtYayYLl9DGLjHkiaG+wfP+J877X7gtvlCpMep8g5Icpd6cJbOUGMJAhdBXWNl5sGTngVmA709w9XpIyQQ2YjQ2MtlXIQ4NOGpKrhrk1MnAyBE7M5o9l0rhGfA2qEUS21NqRE2a07iY7K5N1q6/AUzKDIJlnJgiAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"img",properties:{className:["gatsby-resp-image-image"],style:"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;",alt:"sentry-banner",title:"",src:"/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-6cf1b.png",srcSet:["/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-dbbfd.png 200w","/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-1cc64.png 400w","/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-6cf1b.png 800w","/static/sentry-banner-3010ad43f66a19278336c85b8e81c764-f44ef.png 1147w"],sizes:["(max-width:","800px)","100vw,","800px"]},children:[]},{type:"text",value:"\n    "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"element",tagName:"a",properties:{href:"https://github.com/getsentry/sentry"},children:[{type:"text",value:"Sentry"}]},{type:"text",value:" is a an open-source error tracking platform that helps developer to mointor and fix crashes in real time. It supports most popular languages, including but not limited to Java, JavaScript, Node.js, Android, iOS and Python."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"For more details, please visit "},{type:"element",tagName:"a",properties:{href:"../sentry-intro/"},children:[{type:"text",value:"Sentry Introduction"}]},{type:"text",value:" that I wrote in previous post."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"In this tutorial, we will go through how to set up Sentry via Docker and how to rebuild docker image after installing additional plugin."}]},{type:"text",value:"\n"},{type:"element",tagName:"h2",properties:{},children:[{type:"text",value:"Introduction"}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Sentry Server is written in Python. It uses Django as the web framework. Sentry also relies on the following services:"}]},{type:"text",value:"\n"},{type:"element",tagName:"ul",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"Postgres"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"Redis"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"Memcached"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Sentry can be installed via Docker or via Python. We will only cover how to install via Docker in this tutorial."}]},{type:"text",value:"\n"},{type:"element",tagName:"h2",properties:{},children:[{type:"text",value:"Prerequisite"}]},{type:"text",value:"\n"},{type:"element",tagName:"ul",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"Docker 1.10.0+ "},{type:"element",tagName:"a",properties:{href:"https://docs.docker.com/install/linux/docker-ce/ubuntu/"},children:[{type:"text",value:"(Installation Guide)"}]}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"Docker Compose 1.6.0+ "},{type:"element",tagName:"a",properties:{href:"https://docs.docker.com/compose/install/"},children:[{type:"text",value:"(Installation Guide)"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"h2",properties:{},children:[{type:"text",value:"Getting Started"}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Visit "},{type:"element",tagName:"a",properties:{href:"https://github.com/getsentry/onpremise"},children:[{type:"text",value:"Sentry On-Premise Github"}]},{type:"text",value:", and clone the repo to a directory"}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"git clone --depth=1 https://github.com/getsentry/onpremise.git"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Open "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose.yml"}]},{type:"text",value:", we are going to customize the services we need."}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"version: '3.4'\n\nx-defaults: &defaults\n  restart: unless-stopped\n  build: .\n  depends_on:\n    - redis\n    - postgres\n    - memcached\n    #- smtp\n\n  environment:\n    # Run `docker-compose run web config generate-secret-key`\n    # to get the SENTRY_SECRET_KEY value.\n    SENTRY_SECRET_KEY: ''\n    SENTRY_MEMCACHED_HOST: memcached\n    SENTRY_REDIS_HOST: redis\n    SENTRY_POSTGRES_HOST: postgres\n    SENTRY_EMAIL_HOST: smtp\n  volumes:\n    - sentry-data:/var/lib/sentry/files\n\nservices:\n  #smtp:\n    #restart: unless-stopped\n    #image: tianon/exim4\n\n  memcached:\n    restart: unless-stopped\n    image: memcached:1.4\n\n  redis:\n    restart: unless-stopped\n    image: redis:3.2-alpine\n\n  postgres:\n    restart: unless-stopped\n    image: postgres:9.5\n    volumes:\n      - sentry-postgres:/var/lib/postgresql/data\n\n  web:\n    <<: *defaults\n    ports:\n      - '9000:9000'\n\n  cron:\n    <<: *defaults\n    command: run cron\n\n  worker:\n    <<: *defaults\n    command: run worker\n\nvolumes:\n    sentry-data:\n    sentry-postgres:"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Since we do not want to host a SMTP server by ourselves (will shows you how to set up external SMTP later), so we can comment out all the SMTP related lines."}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Build and tag the Docker services. It will pull the required docker images specified in "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose.yml"}]},{type:"text",value:" and "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"Dockerfile"}]},{type:"text",value:", i.e. "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"redis:3.2-alpine"}]},{type:"text",value:", "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"postgres:9.5"}]},{type:"text",value:", "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"memcached:1.4"}]},{type:"text",value:" and "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"sentry:9.0-onbuild"}]},{type:"text",value:"."}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose build"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"After finish building the docker images, we have to generate a secrete key for Sentry"}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose run --rm web config generate-secret-key"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Add copy the key to "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose.yml"}]},{type:"text",value:" in "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"SENTRY_SECRET_KEY"}]},{type:"text",value:"."}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"After we have configured the key, we have to run data migration on the postgres database."}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose run --rm web upgrade"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"In the meantime, there will be interactive prompts to create an admin user account."}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Starts all the services in detached mode."}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose up -d"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"By running "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker ps"}]},{type:"text",value:", you should see 6 running containers as follows:"}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:'CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\nd746f33fc02c        sentry_worker       "/entrypoint.sh run …"   8 days ago          Up 2 days           9000/tcp                 sentry_worker_1\n9f392974eb82        sentry_cron         "/entrypoint.sh run …"   8 days ago          Up 2 days           9000/tcp                 sentry_cron_1\n288c296596b4        sentry_web          "/entrypoint.sh run …"   8 days ago          Up 2 days           0.0.0.0:9000->9000/tcp   sentry_web_1\n0e2b7144edce        postgres:9.5        "docker-entrypoint.s…"   8 days ago          Up 2 days           5432/tcp                 sentry_postgres_1\n2f1f93436a77        redis:3.2-alpine    "docker-entrypoint.s…"   8 days ago          Up 2 days           6379/tcp                 sentry_redis_1\ned98daa7e684        memcached:1.4       "docker-entrypoint.s…"   8 days ago          Up 2 days           11211/tcp                sentry_memcached_1'}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Sentry can now be accessed via "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"localhost:9000"}]}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"h2",properties:{},children:[{type:"text",value:"Set up mail server"}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Edit "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"config.yml"}]},{type:"text",value:", add the corresponding mail server settings:"}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"###############\n# Mail Server #\n###############\nmail.backend: 'smtp'  # Use dummy if you want to disable email entirely\nmail.host: 'smtp.gmail.com'\nmail.port: 587\nmail.username: 'YOUR_EMAIL@gmail.com'\nmail.password: 'EMAIL_PASSWORD'\nmail.use-tls: true\nmail.list-namespace: example.com\n# The email address to send on behalf of\nmail.from: 'YOUR_EMAIL@gmail.com'"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"You have to stop and remove previous built containers and images"}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose down"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Then rebuild, run migrations and restart services"}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose build # Build the services again after updating\ndocker-compose run --rm web upgrade # Run new migrations\ndocker-compose up -d # Recreate the services"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"h2",properties:{},children:[{type:"text",value:"Google SSO"}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"element",tagName:"a",properties:{href:"https://github.com/getsentry/sentry-auth-google"},children:[{type:"text",value:"GitHub - getsentry/sentry-auth-google: Google Apps SSO provider for Sentry"}]}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Edit "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"requirements.txt"}]},{type:"text",value:", this is the place for specifying dependencies for Python application. Add a new line:"}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"# Add plugins here\nhttps://github.com/getsentry/sentry-auth-google/archive/52020f577f587595fea55f5d05520f1473deaad1.zip"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Open "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"sentry.conf.py"}]},{type:"text",value:", and add Google SSO into the config file:"}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"SENTRY_FEATURES['organizations:sso'] = True\n\nif 'GOOGLE_CLIENT_ID' in os.environ:\n    GOOGLE_CLIENT_ID = env('GOOGLE_CLIENT_ID')\n    GOOGLE_CLIENT_SECRET = env('GOOGLE_CLIENT_SECRET')"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Open "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"docker-compose.yml"}]},{type:"text",value:", add add the "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"GOOGLE_CLIENT_ID"}]},{type:"text",value:" and "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"GOOGLE_CLIENT_SECRET"}]}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"GOOGLE_CLIENT_ID: 'ID_HERE.apps.googleusercontent.com'\nGOOGLE_CLIENT_SECRET: 'SECRET_HERE'"
}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"}]}],data:{quirksMode:!1}},fields:{slug:"/sentry-docker/",prefix:"2019-01-15"},frontmatter:{title:"Deploy Sentry with Docker",subTitle:"An easy guide on how to set up Sentry using Docker Compose",cover:{childImageSharp:{resize:{src:"/static/sentry-09453afd112e62d6803a4dab554cea89-8764f.png"}}}}},author:{id:"C:/Users/opw/Desktop/workspace/blog/content/parts/author.md absPath of file >>> MarkdownRemark",html:"<p><strong>Benny O</strong></p>"},footnote:{id:"C:/Users/opw/Desktop/workspace/blog/content/parts/footnote.md absPath of file >>> MarkdownRemark",html:'<ul>\n<li>2018 © Benny O</li>\n<li>built with React &#x26; Gatsby</li>\n<li>theme template <a href="https://github.com/greglobinski/gatsby-starter-personal-blog">gatsby-starter-personal-blog</a></li>\n</ul>'},site:{siteMetadata:{facebook:{appId:""}}}},pathContext:{slug:"/sentry-docker/"}}}});
//# sourceMappingURL=path---sentry-docker-01a0bb2fac8dc8e650bb.js.map